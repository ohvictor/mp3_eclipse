/***************************************************************************//**
  @file     App.c
  @brief    Application functions
  @author   Facundo Molina
 ******************************************************************************/

/*******************************************************************************
 * INCLUDE HEADER FILES
 ******************************************************************************/
#include "systick.h"
#include "core_cm4.h"

/*******************************************************************************
 * CONSTANT AND MACRO DEFINITIONS USING #DEFINE
 ******************************************************************************/

#define SYSTICK_LOAD_INIT		((__CORE_CLOCK__/SYSTICK_ISR_FREQUENCY_HZ) - 10)

/*******************************************************************************
 * FUNCTION PROTOTYPES FOR PRIVATE FUNCTIONS WITH FILE LEVEL SCOPE
 ******************************************************************************/


/*******************************************************************************
 * STATIC VARIABLES AND CONST VARIABLES WITH FILE LEVEL SCOPE
 ******************************************************************************/

static void (*systick_callback) (void);

/*******************************************************************************
 *******************************************************************************
                        GLOBAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/

bool SysTick_Init (void (*funcallback)(void))
{
	SysTick->CTRL = 0x00;
	SysTick->LOAD = 100000L - 1; // 1ms @ 100MHz
	SysTick->LOAD = SYSTICK_LOAD_INIT;
	SysTick->VAL = 0x00;
	SysTick->CTRL = SysTick_CTRL_CLKSOURCE_Msk | SysTick_CTRL_TICKINT_Msk | SysTick_CTRL_ENABLE_Msk;
	systick_callback = funcallback;
	return 1;
}


__ISR__ SysTick_Handler (void)
{
	systick_callback();
}

/*******************************************************************************
 *******************************************************************************
                        LOCAL FUNCTION DEFINITIONS
 *******************************************************************************
 ******************************************************************************/




/*******************************************************************************
 ******************************************************************************/
